/**
 * Module-Vulnerability Mappings
 *
 * This file defines the relationships between HTB Academy modules and vulnerabilities.
 * Since the HTB API doesn't provide this data, these mappings are manually curated
 * based on the module content and learning objectives.
 */

export interface ModuleVulnerabilityMapping {
  moduleId: number;
  vulnerabilityIds: number[];
}

/**
 * Maps module IDs to their related vulnerability IDs
 * Only includes vulnerabilities that are directly taught or practiced in the module
 */
export const moduleVulnerabilityMappings: ModuleVulnerabilityMapping[] = [
  // SQL Injection Related Modules
  { moduleId: 33, vulnerabilityIds: [3639] }, // SQL Injection Fundamentals → SQL Injection
  { moduleId: 58, vulnerabilityIds: [3639] }, // SQLMap Essentials → SQL Injection
  { moduleId: 188, vulnerabilityIds: [3639, 3681, 3674, 3688] }, // Advanced SQL Injections → SQL Injection, NoSQL Injection, HQL Injection, SQL Truncation
  { moduleId: 177, vulnerabilityIds: [3639] }, // Blind SQL Injection → SQL Injection

  // XSS and CSRF Related Modules
  { moduleId: 103, vulnerabilityIds: [3653] }, // Cross-Site Scripting (XSS) → Cross Site Scripting (XSS)
  { moduleId: 235, vulnerabilityIds: [3653, 3659, 3669] }, // Advanced XSS and CSRF Exploitation → XSS, CSRF, CORS

  // Command Injection Related Modules
  { moduleId: 109, vulnerabilityIds: [3647, 3693, 3658, 3673] }, // Command Injections → OS Command Injection, Command Execution, Code Execution, Code Injection
  { moduleId: 48, vulnerabilityIds: [3647, 3673] }, // Whitebox Pentesting 101: Command Injection → OS Command Injection, Code Injection

  // File Inclusion Related Modules
  { moduleId: 23, vulnerabilityIds: [3641, 3642, 3668, 3643] }, // File Inclusion → Local File Inclusion, Remote File Inclusion, Directory Traversal, Arbitrary File Read

  // File Upload Related Modules
  { moduleId: 136, vulnerabilityIds: [3648, 3667, 3645] }, // File Upload Attacks → Arbitrary File Upload, Arbitrary File Write, Remote Code Execution

  // Authentication Related Modules
  { moduleId: 80, vulnerabilityIds: [3656, 3644, 3662, 3680, 3646] }, // Broken Authentication → Weak Authentication, Weak Credentials, Default Credentials, Hard-coded Credentials, Clear Text Credentials
  { moduleId: 170, vulnerabilityIds: [3656, 3644, 3662, 3646] }, // Attacking Authentication Mechanisms → Weak Authentication, Weak Credentials, Default Credentials, Clear Text Credentials
  { moduleId: 57, vulnerabilityIds: [3644, 3662, 3656] }, // Login Brute Forcing → Weak Credentials, Default Credentials, Weak Authentication
  { moduleId: 147, vulnerabilityIds: [3644, 3662, 3677] }, // Password Attacks → Weak Credentials, Default Credentials, Weak Cryptography
  { moduleId: 20, vulnerabilityIds: [3644, 3677] }, // Cracking Passwords with Hashcat → Weak Credentials, Weak Cryptography

  // Session Security
  { moduleId: 153, vulnerabilityIds: [3659, 3663] }, // Session Security → CSRF, IDOR

  // Deserialization Related Modules
  { moduleId: 169, vulnerabilityIds: [3650] }, // Introduction to Deserialization Attacks → Deserialization
  { moduleId: 240, vulnerabilityIds: [3650] }, // Advanced Deserialization Attacks → Deserialization

  // Server-Side Attacks
  { moduleId: 145, vulnerabilityIds: [3655, 3665, 3698, 3652] }, // Server-side Attacks → SSRF, SSTI, SSI Injection, XXE Injection
  { moduleId: 160, vulnerabilityIds: [3655, 3652, 3639, 3665] }, // Web Service & API Attacks → SSRF, XXE, SQL Injection, SSTI

  // Injection Attacks
  { moduleId: 204, vulnerabilityIds: [3673, 3647, 3639, 3681, 3690, 3682, 3679, 3703, 3710] }, // Injection Attacks → Code Injection, OS Command Injection, SQL Injection, NoSQL Injection, LDAP Injection, XPath Injection, CRLF Injection, HTML Injection, Cypher Injection
  { moduleId: 171, vulnerabilityIds: [3681] }, // Introduction to NoSQL Injection → NoSQL Injection

  // Web Application Fundamentals
  { moduleId: 75, vulnerabilityIds: [3653, 3639, 3641] }, // Introduction to Web Applications → XSS, SQL Injection, Local File Inclusion
  { moduleId: 134, vulnerabilityIds: [3653, 3639, 3647, 3641, 3663, 3652] }, // Web Attacks → XSS, SQL Injection, OS Command Injection, Local File Inclusion, IDOR, XXE
  { moduleId: 54, vulnerabilityIds: [3668, 3649, 3657] }, // Attacking Web Applications with Ffuf → Directory Traversal, Directory Listing, Information Disclosure
  { moduleId: 280, vulnerabilityIds: [3702, 3657] }, // Web Fuzzing → Improper Input Validation, Information Disclosure

  // HTTP and Network Attacks
  { moduleId: 191, vulnerabilityIds: [3660, 3695, 3694] }, // HTTP Attacks → Host Header Injection, HTTP request smuggling, Execution After Redirect
  { moduleId: 184, vulnerabilityIds: [3677, 3689] }, // HTTPs/TLS Attacks → Weak Cryptography, Sensitive Data Exposure
  { moduleId: 189, vulnerabilityIds: [3664, 3660, 3678] }, // Abusing HTTP Misconfigurations → Misconfiguration, Host Header Injection, Anonymous/Guest Access

  // API Attacks
  { moduleId: 268, vulnerabilityIds: [3697, 3663, 3639, 3655] }, // API Attacks → Mass Assignment, IDOR, SQL Injection, SSRF
  { moduleId: 271, vulnerabilityIds: [3702, 3663] }, // Attacking GraphQL → Improper Input Validation, IDOR

  // Modern Web Exploitation
  { moduleId: 231, vulnerabilityIds: [3666, 3685, 3687] }, // Modern Web Exploitation Techniques → Prototype Pollution, PHP type juggling, Cross Site Websocket Hijacking

  // Parameter and Logic Bugs
  { moduleId: 239, vulnerabilityIds: [3675, 3663, 3697] }, // Parameter Logic Bugs → Race Condition, IDOR, Mass Assignment

  // Information Disclosure
  { moduleId: 144, vulnerabilityIds: [3657, 3689, 3649] }, // Information Gathering - Web Edition → Information Disclosure, Sensitive Data Exposure, Directory Listing

  // Active Directory Attacks
  { moduleId: 25, vulnerabilityIds: [3644, 3662, 3656] }, // Kerberos Attacks → Weak Credentials, Default Credentials, Weak Authentication
  { moduleId: 143, vulnerabilityIds: [3644, 3662, 3671, 3654, 3646] }, // Active Directory Enumeration & Attacks → Weak Credentials, Default Credentials, Weak Permissions, Group Membership, Clear Text Credentials
  { moduleId: 253, vulnerabilityIds: [3664, 3671] }, // Active Directory Trust Attacks → Misconfiguration, Weak Permissions
  { moduleId: 219, vulnerabilityIds: [3671, 3654] }, // DACL Attacks I → Weak Permissions, Group Membership
  { moduleId: 255, vulnerabilityIds: [3671, 3654] }, // DACL Attacks II → Weak Permissions, Group Membership
  { moduleId: 22, vulnerabilityIds: [3690] }, // Active Directory LDAP → LDAP Injection
  { moduleId: 232, vulnerabilityIds: [3656, 3664] }, // NTLM Relay Attacks → Weak Authentication, Misconfiguration
  { moduleId: 267, vulnerabilityIds: [3664, 3671, 3644] }, // MSSQL, Exchange, and SCCM Attacks → Misconfiguration, Weak Permissions, Weak Credentials
  { moduleId: 236, vulnerabilityIds: [3664, 3671] }, // ADCS Attacks → Misconfiguration, Weak Permissions
  { moduleId: 263, vulnerabilityIds: [3671, 3646, 3692] }, // Windows Lateral Movement → Weak Permissions, Clear Text Credentials, Autologon Credentials

  // Windows Privilege Escalation
  { moduleId: 67, vulnerabilityIds: [3671, 3644, 3664, 3692, 3646] }, // Windows Privilege Escalation → Weak Permissions, Weak Credentials, Misconfiguration, Autologon Credentials, Clear Text Credentials
  { moduleId: 51, vulnerabilityIds: [3671, 3664, 3646] }, // Linux Privilege Escalation → Weak Permissions, Misconfiguration, Clear Text Credentials

  // Network Service Attacks
  { moduleId: 116, vulnerabilityIds: [3662, 3644, 3664, 3691] }, // Attacking Common Services → Default Credentials, Weak Credentials, Misconfiguration, Zone Transfer
  { moduleId: 113, vulnerabilityIds: [3662, 3644, 3664] }, // Attacking Common Applications → Default Credentials, Weak Credentials, Misconfiguration

  // Buffer Overflow
  { moduleId: 31, vulnerabilityIds: [3640, 3645] }, // Stack-Based Buffer Overflows on Linux x86 → Buffer Overflow, Remote Code Execution
  { moduleId: 89, vulnerabilityIds: [3640, 3645] }, // Stack-Based Buffer Overflows on Windows x86 → Buffer Overflow, Remote Code Execution
  { moduleId: 258, vulnerabilityIds: [3640, 3686, 3705] }, // Introduction to Binary Fuzzing → Buffer Overflow, Heap Overflow, Integer Overflow

  // WordPress
  { moduleId: 17, vulnerabilityIds: [3639, 3653, 3641, 3648] }, // Hacking WordPress → SQL Injection, XSS, Local File Inclusion, Arbitrary File Upload

  // JavaScript
  { moduleId: 41, vulnerabilityIds: [3658, 3657] }, // JavaScript Deobfuscation → Code Execution, Information Disclosure
  { moduleId: 38, vulnerabilityIds: [3653, 3673, 3666] }, // Secure Coding 101: JavaScript → XSS, Code Injection, Prototype Pollution

  // Whitebox Testing
  { moduleId: 205, vulnerabilityIds: [3639, 3673, 3650, 3702] }, // Whitebox Attacks → SQL Injection, Code Injection, Deserialization, Improper Input Validation
  { moduleId: 244, vulnerabilityIds: [3639, 3673, 3650, 3702] }, // Intro to Whitebox Pentesting → SQL Injection, Code Injection, Deserialization, Improper Input Validation

  // Wi-Fi Attacks
  { moduleId: 222, vulnerabilityIds: [3664, 3644, 3677] }, // Wi-Fi Penetration Testing Basics → Misconfiguration, Weak Credentials, Weak Cryptography
  { moduleId: 185, vulnerabilityIds: [3677, 3644] }, // Wired Equivalent Privacy (WEP) Attacks → Weak Cryptography, Weak Credentials
  { moduleId: 186, vulnerabilityIds: [3664, 3644] }, // Attacking Wi-Fi Protected Setup (WPS) → Misconfiguration, Weak Credentials
  { moduleId: 282, vulnerabilityIds: [3644, 3677] }, // Attacking WPA/WPA2 Wi-Fi Networks → Weak Credentials, Weak Cryptography
  { moduleId: 304, vulnerabilityIds: [3644, 3677] }, // Attacking WPA3 Wi-Fi Networks → Weak Credentials, Weak Cryptography
  { moduleId: 305, vulnerabilityIds: [3664, 3644] }, // Attacking Corporate Wi-Fi Networks → Misconfiguration, Weak Credentials
  { moduleId: 291, vulnerabilityIds: [3656, 3664] }, // Wi-Fi Evil Twin Attacks → Weak Authentication, Misconfiguration
  { moduleId: 312, vulnerabilityIds: [3644, 3677] }, // Wi-Fi Password Cracking Techniques → Weak Credentials, Weak Cryptography

  // Android Security
  { moduleId: 221, vulnerabilityIds: [3657, 3680, 3646] }, // Android Application Static Analysis → Information Disclosure, Hard-coded Credentials, Clear Text Credentials
  { moduleId: 249, vulnerabilityIds: [3702, 3663, 3646] }, // Android Application Dynamic Analysis → Improper Input Validation, IDOR, Clear Text Credentials
  { moduleId: 272, vulnerabilityIds: [3658, 3645] }, // Android Application Malware Analysis → Code Execution, Remote Code Execution

  // Forensics
  { moduleId: 237, vulnerabilityIds: [3657, 3689] }, // Introduction to Digital Forensics → Information Disclosure, Sensitive Data Exposure
  { moduleId: 247, vulnerabilityIds: [3657, 3689, 3672] }, // Introduction to Linux Forensics → Information Disclosure, Sensitive Data Exposure, Log Poisoning
  { moduleId: 288, vulnerabilityIds: [3657, 3689] }, // Android Forensics → Information Disclosure, Sensitive Data Exposure

  // Malware Analysis
  { moduleId: 227, vulnerabilityIds: [3645, 3658] }, // Introduction to Malware Analysis → Remote Code Execution, Code Execution
  { moduleId: 265, vulnerabilityIds: [3650, 3652, 3673] }, // Malicious Document Analysis → Deserialization, XXE Injection, Code Injection

  // Windows Evasion and Detection
  { moduleId: 254, vulnerabilityIds: [3683, 3658] }, // Introduction to Windows Evasion Techniques → Path Hijacking, Code Execution
  { moduleId: 266, vulnerabilityIds: [3658, 3645] }, // Process Injection Attacks and Detection → Code Execution, Remote Code Execution
  { moduleId: 316, vulnerabilityIds: [3658, 3645] }, // Linux Process Injections & Detections → Code Execution, Remote Code Execution

  // AI Security
  { moduleId: 297, vulnerabilityIds: [3673, 3702] }, // Prompt Injection Attacks → Code Injection, Improper Input Validation
  { moduleId: 307, vulnerabilityIds: [3673, 3702] }, // LLM Output Attacks → Code Injection, Improper Input Validation
  { moduleId: 302, vulnerabilityIds: [3702, 3657] }, // AI Data Attacks → Improper Input Validation, Information Disclosure
  { moduleId: 315, vulnerabilityIds: [3702, 3658] }, // Attacking AI - Application and System → Improper Input Validation, Code Execution

  // Supply Chain
  { moduleId: 243, vulnerabilityIds: [3664, 3701, 3650] }, // Supply Chain Attacks → Misconfiguration, Insecure Design, Deserialization

  // C2 Operations
  { moduleId: 241, vulnerabilityIds: [3645, 3658] }, // Intro to C2 Operations with Sliver → Remote Code Execution, Code Execution

  // Misconfiguration Related
  { moduleId: 108, vulnerabilityIds: [3664, 3657] }, // Vulnerability Assessment → Misconfiguration, Information Disclosure
  { moduleId: 112, vulnerabilityIds: [3657, 3664] }, // Footprinting → Information Disclosure, Misconfiguration
  { moduleId: 19, vulnerabilityIds: [3664, 3657] }, // Network Enumeration with Nmap → Misconfiguration, Information Disclosure

  // Proxy and Traffic Analysis
  { moduleId: 110, vulnerabilityIds: [3663, 3653] }, // Using Web Proxies → IDOR, XSS

  // Hardware Attacks
  { moduleId: 230, vulnerabilityIds: [3684, 3640] }, // Brief Intro to Hardware Attacks → Format String, Buffer Overflow

  // Game Hacking
  { moduleId: 182, vulnerabilityIds: [3640, 3658, 3675] }, // Game Hacking Fundamentals → Buffer Overflow, Code Execution, Race Condition

  // Windows Event Logs
  { moduleId: 216, vulnerabilityIds: [3657, 3672] }, // Windows Event Logs & Finding Evil → Information Disclosure, Log Poisoning
];

/**
 * Validates that all module IDs and vulnerability IDs exist in the database
 */
export function validateMappings(
  existingModuleIds: number[],
  existingVulnerabilityIds: number[]
): { valid: boolean; errors: string[] } {
  const errors: string[] = [];

  for (const mapping of moduleVulnerabilityMappings) {
    if (!existingModuleIds.includes(mapping.moduleId)) {
      errors.push(`Module ID ${mapping.moduleId} does not exist in database`);
    }

    for (const vulnId of mapping.vulnerabilityIds) {
      if (!existingVulnerabilityIds.includes(vulnId)) {
        errors.push(`Vulnerability ID ${vulnId} does not exist in database`);
      }
    }
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}
